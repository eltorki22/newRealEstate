import{a as m}from"./chunk-4IBYQYSO.js";import{M as d,Ya as l,Za as f,t as c,w as s,x as p}from"./chunk-KT3ALLZ7.js";var n=class extends Error{};n.prototype.name="InvalidTokenError";function u(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}function w(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return u(e)}catch{return atob(e)}}function g(r,e){if(typeof r!="string")throw new n("Invalid token specified: must be a string");e||(e={});let t=e.header===!0?0:1,o=r.split(".")[t];if(typeof o!="string")throw new n(`Invalid token specified: missing part #${t+1}`);let a;try{a=w(o)}catch(i){throw new n(`Invalid token specified: invalid base64 for part #${t+1} (${i.message})`)}try{return JSON.parse(a)}catch(i){throw new n(`Invalid token specified: invalid json for part #${t+1} (${i.message})`)}}var h=class r{constructor(e){this.platformId=e}http=p(f);apiUrl=m.apiUrl;isTokenExpired(e){try{let t=g(e),o=Math.floor(Date.now()/1e3);return t.exp<o}catch(t){return console.error("Invalid token:",t),!0}}checkAndRemoveExpiredToken(){if(l(this.platformId)){let e=localStorage.getItem("token");e&&this.isTokenExpired(e)&&(localStorage.removeItem("token"),console.warn("Token expired and removed"))}}onLogin(e,t){let o={username:e,password:t};return this.http.post(this.apiUrl+"/Auth/login",o)}isLoggedIn(){return typeof window>"u"?!1:!!localStorage.getItem("token")}static \u0275fac=function(t){return new(t||r)(s(d))};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};export{h as a};
