import{a as ne}from"./chunk-EFPNG5KI.js";import{a as T}from"./chunk-GQVR4KT5.js";import{a as te}from"./chunk-SLAQIVID.js";import{b as B,c as f,d as G,e as U,g as L,j as z,k as H,l as W,m as J,n as K,o as Q,r as X,t as Y}from"./chunk-SE6REB2C.js";import{a as Z}from"./chunk-7RSTTL6O.js";import{a as q}from"./chunk-4IBYQYSO.js";import{a as ee}from"./chunk-MJHHVN4F.js";import{$ as m,A as b,D as I,E as N,Q as l,Ta as O,Xa as P,Z as y,Za as $,ba as C,ca as S,da as v,ea as i,eb as j,fa as n,ga as u,ha as A,ia as D,ka as V,la as h,ma as g,mb as w,t as k,u as x,ua as o,va as c,x as d,z as R}from"./chunk-KT3ALLZ7.js";var E=class r{constructor(){}http=d($);apiUrl=q.apiUrl;getEmployeesalary(){return this.http.get(this.apiUrl+"/api/Employee/GetEmployeesWithSalaryAndLoans")}getDataAllList(t){return this.http.post(this.apiUrl+"/api/SalaryVoucher/ListAsync",t)}addData(t){return this.http.post(this.apiUrl+"/api/SalaryVoucher/Add",t)}static \u0275fac=function(e){return new(e||r)};static \u0275prov=k({token:r,factory:r.\u0275fac,providedIn:"root"})};function oe(r,t){r&1&&(i(0,"small"),o(1," \u0631\u0642\u0645 \u0627\u0644\u0633\u0646\u062F \u0645\u0637\u0644\u0648\u0628"),n())}function re(r,t){if(r&1&&(A(0),y(1,oe,2,0,"small",7),D()),r&2){let e=g();l(),m("ngIf",e.exChangeForms.controls.voucherNumber.hasError("required"))}}function le(r,t){r&1&&(i(0,"small"),o(1," \u0627\u0644\u062A\u0627\u0631\u064A\u062E \u0645\u0637\u0644\u0648\u0628"),n())}function me(r,t){if(r&1&&(A(0),y(1,le,2,0,"small",7),D()),r&2){let e=g();l(),m("ngIf",e.exChangeForms.controls.voucherDate.hasError("required"))}}function se(r,t){if(r&1&&(i(0,"option",14),o(1),n()),r&2){let e=t.$implicit;m("value",e.id),l(),c(e.fullName)}}function ue(r,t){if(r&1&&(i(0,"option",14),o(1),n()),r&2){let e=t.$implicit;m("value",e.id),l(),c(e.accountName)}}function ce(r,t){if(r&1){let e=V();i(0,"tr")(1,"th"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),o(8),n(),i(9,"td"),o(10),n(),i(11,"td"),o(12),n(),i(13,"td"),o(14),n(),i(15,"td"),o(16),n(),i(17,"td"),o(18),n(),i(19,"td")(20,"button",21),h("click",function(){let s=I(e).$index,p=g();return N(p.editRow(s))}),u(21,"i",22),n(),i(22,"button",23),h("click",function(){let s=I(e).$index,p=g();return N(p.deleteRow(s))}),u(23,"i",24),n()()()}if(r&2){let e=t.$implicit,a=t.$index,s=g();l(2),c(a+1),l(2),c(s.getEmployeeNameById(e.employeeId)),l(2),c(e.baseSalary),l(2),c(s.getAccountNameById(e.accountId)),l(2),c(e.absenceDays),l(2),c(e.loanRepayment),l(2),c(e.deductions),l(2),c(e.bonuses),l(2),c(e.netSalary)}}function de(r,t){r&1&&(i(0,"tr")(1,"td",25),u(2,"i",26)(3,"br"),o(4," \u0644\u0627 \u062A\u0648\u062C\u062F \u0628\u064A\u0627\u0646\u0627\u062A \u062D\u062A\u0649 \u0627\u0644\u0622\u0646 "),n()())}var _=class r{exChangeForms;rowForm;getAllData=[];getNameEmployee=[];accountNameData=[];editIndex=null;subScription;EmployeeService=d(ne);exChangeSalariesser=d(E);accountser=d(te);fb=d(X);toastr=d(Z);title=d(j);ngOnInit(){this.title.setTitle("\u0635\u0631\u0641 \u0627\u0644\u0631\u0648\u0627\u062A\u0628 "),this.getEmployeeName(),this.getAccountName(),this.exChangeForms=this.fb.group({voucherNumber:["",f.required],voucherDate:[T(),f.required]}),this.rowForm=this.fb.group({employeeId:[null,f.required],baseSalary:[0,f.required],accountId:[null,f.required],absenceDays:[0],deductions:[0],bonuses:[0],loanRepayment:[0]}),this.rowForm.valueChanges.subscribe(()=>{this.calculateNetSalary()})}netSalaryPreview=0;calculateNetSalary(){let t=+this.rowForm.get("baseSalary")?.value||0,e=+this.rowForm.get("absenceDays")?.value||0,a=+this.rowForm.get("loanRepayment")?.value||0,s=+this.rowForm.get("deductions")?.value||0,p=+this.rowForm.get("bonuses")?.value||0,ae=t-a-s-e+p;this.netSalaryPreview=ae}getFormControl(t){return this.rowForm.get(t)}getEmployeeName(){let t={pageIndex:0,pageSize:0};this.subScription=this.exChangeSalariesser.getEmployeesalary().subscribe(e=>{this.getNameEmployee=e.rows.map(a=>({id:a.id,fullName:a.fullName,salary:a.salary,remainingAmount:a.remainingAmount}))})}getAccountName(){let t={pageIndex:0,pageSize:0};this.subScription=this.accountser.getAllDataList(t).subscribe(e=>{this.accountNameData=e.rows.map(a=>({id:a.id,accountName:a.accountName}))})}ChangeSelectEmp(t){let e=+t.target.value,a=this.getNameEmployee.find(s=>s.id===e);a&&this.rowForm.patchValue({baseSalary:a.salary,loanRepayment:a.remainingAmount})}AddDataSalary(){let t=this.rowForm.value;if(!this.rowForm.valid){this.toastr.show("\u064A\u0631\u062C\u0649 \u062A\u0639\u0628\u0626\u0629 \u062C\u0645\u064A\u0639 \u062D\u0642\u0648\u0644 \u0627\u0644\u0645\u0648\u0638\u0641","error");return}let e={employeeId:+t.employeeId,baseSalary:+t.baseSalary||0,accountId:+t.accountId,absenceDays:+t.absenceDays||0,deductions:+t.deductions||0,bonuses:+t.bonuses||0,loanRepayment:+t.loanRepayment||0};this.editIndex!==null?(this.getAllData[this.editIndex]=e,this.editIndex=null):this.getAllData.push(e),this.rowForm.reset({employeeId:null,baseSalary:0,accountId:null,absenceDays:0,deductions:0,bonuses:0,loanRepayment:0})}getEmployeeNameById(t){let e=this.getNameEmployee.find(a=>a.id===t);return e?e.fullName:""}getAccountNameById(t){let e=this.accountNameData.find(a=>a.id===t);return e?e.accountName:""}editRow(t){this.rowForm.patchValue(this.getAllData[t]),this.editIndex=t}deleteRow(t){this.getAllData.splice(t,1)}onSubmit(){if(this.exChangeForms.valid&&this.getAllData.length>0){let t={voucherNumber:this.exChangeForms.value.voucherNumber,voucherDate:this.exChangeForms.value.voucherDate,employeeSalarySheets:this.getAllData};this.exChangeSalariesser.addData(t).subscribe(()=>{this.toastr.show("\u062A\u0645 \u0625\u0636\u0627\u0641\u0629 \u0627\u0644\u0628\u064A\u0627\u0646\u0627\u062A \u0628\u0646\u062C\u0627\u062D","success"),this.exChangeForms.reset({voucherDate:T()}),this.getAllData=[]})}else this.exChangeForms.markAllAsTouched()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=R({type:r,selectors:[["app-exchangesalaries"]],decls:77,vars:13,consts:[["appIntersection","fade-in",1,"title-page"],["src","assets/dashboard/iconarrowdouble.png","alt","icon",1,"mx-1"],["appIntersection","fade-in",1,"forms_dashboard",3,"ngSubmit","formGroup"],[1,"row"],[1,"mb-3","col-sm-12","col-md-6"],["for","arestnumber",1,"form-label"],["type","text","id","arestnumber","formControlName","voucherNumber",1,"form-control"],[4,"ngIf"],["for","date",1,"form-label"],["type","date","id","date","formControlName","voucherDate",1,"form-control"],["appIntersection","fade-in",1,"table-responsive"],[1,"table","table-striped","mt-4"],[1,"form-select",3,"change","formControl"],["value","","disabled","","selected",""],[3,"value"],["type","text","readonly","",1,"form-control","text-center",3,"formControl"],[1,"form-select",3,"formControl"],["type","text",1,"form-control","text-center",3,"formControl"],["type","text","readonly","",1,"form-control","text-center",3,"value"],["type","button",1,"btn","btn-success",3,"click"],["type","submit",1,"btn","mt-3","d-block","me-auto","text-white",2,"background-color","#157347"],[1,"btn","btn-success","ms-1",3,"click"],[1,"fa-solid","fa-pen-to-square"],[1,"btn","btn-danger",3,"click"],[1,"fa-solid","fa-trash"],["colspan","12",1,"text-center","py-5",2,"color","#888","font-size","18px"],[1,"fa-solid","fa-circle-exclamation","fa-2x","mb-2",2,"color","#ccc"]],template:function(e,a){e&1&&(i(0,"h3",0),o(1," \u0627\u0644\u0627\u062F\u0648\u0627\u062A "),u(2,"img",1),i(3,"span"),o(4,"\u0635\u0631\u0641 \u0627\u0644\u0631\u0648\u0627\u062A\u0628"),n()(),i(5,"form",2),h("ngSubmit",function(){return a.onSubmit()}),i(6,"div",3)(7,"div",4)(8,"label",5),o(9,"\u0631\u0642\u0645 \u0627\u0644\u0633\u0646\u062F"),n(),u(10,"input",6),y(11,re,2,1,"ng-container",7),n(),i(12,"div",4)(13,"label",8),o(14,"\u0627\u0644\u062A\u0627\u0631\u064A\u062E"),n(),u(15,"input",9),y(16,me,2,1,"ng-container",7),n()(),i(17,"div",10)(18,"table",11)(19,"thead")(20,"tr")(21,"th"),o(22,"\u0645"),n(),i(23,"th"),o(24,"\u0627\u0633\u0645 \u0627\u0644\u0645\u0648\u0638\u0641"),n(),i(25,"th"),o(26,"\u0627\u0644\u0631\u0627\u062A\u0628"),n(),i(27,"th"),o(28,"\u0627\u0644\u0635\u0646\u062F\u0648\u0642"),n(),i(29,"th"),o(30,"\u063A\u064A\u0627\u0628"),n(),i(31,"th"),o(32,"\u0633\u0644\u0641\u0629"),n(),i(33,"th"),o(34,"\u062C\u0632\u0627\u0621"),n(),i(35,"th"),o(36,"\u0645\u0643\u0627\u0641\u0623\u0629"),n(),i(37,"th"),o(38,"\u0635\u0627\u0641\u064A"),n(),i(39,"th"),o(40,"\u0627\u0644\u0639\u0645\u0644\u064A\u0627\u062A"),n()()(),i(41,"tbody")(42,"tr")(43,"th"),o(44,"\u062C\u062F\u064A\u062F"),n(),i(45,"td")(46,"select",12),h("change",function(p){return a.ChangeSelectEmp(p)}),i(47,"option",13),o(48,"\u0627\u0633\u0645 \u0627\u0644\u0645\u0648\u0638\u0641"),n(),S(49,se,2,2,"option",14,C),n()(),i(51,"td"),u(52,"input",15),n(),i(53,"td")(54,"select",16)(55,"option",13),o(56,"-----"),n(),S(57,ue,2,2,"option",14,C),n()(),i(59,"td"),u(60,"input",17),n(),i(61,"td"),u(62,"input",15),n(),i(63,"td"),u(64,"input",17),n(),i(65,"td"),u(66,"input",17),n(),i(67,"td"),u(68,"input",18),n(),i(69,"td")(70,"button",19),h("click",function(){return a.AddDataSalary()}),o(71),n()()(),S(72,ce,24,9,"tr",null,C,!1,de,5,0,"tr"),n()(),i(75,"button",20),o(76,"\u062D\u0641\u0638"),n()()()),e&2&&(l(5),m("formGroup",a.exChangeForms),l(6),m("ngIf",a.exChangeForms.controls.voucherNumber.invalid&&a.exChangeForms.controls.voucherNumber.touched),l(5),m("ngIf",a.exChangeForms.controls.voucherDate.invalid&&a.exChangeForms.controls.voucherDate.touched),l(30),m("formControl",a.getFormControl("employeeId")),l(3),v(a.getNameEmployee),l(3),m("formControl",a.getFormControl("baseSalary")),l(2),m("formControl",a.getFormControl("accountId")),l(3),v(a.accountNameData),l(3),m("formControl",a.getFormControl("absenceDays")),l(2),m("formControl",a.getFormControl("loanRepayment")),l(2),m("formControl",a.getFormControl("deductions")),l(2),m("formControl",a.getFormControl("bonuses")),l(2),m("value",a.netSalaryPreview),l(3),c(a.editIndex!==null?"\u062A\u0639\u062F\u064A\u0644":"\u0625\u0636\u0627\u0641\u0629"),l(),v(a.getAllData))},dependencies:[O,L,K,Q,B,J,G,U,z,H,W,ee],styles:[".forms_dashboard[_ngcontent-%COMP%]{background-color:transparent}.forms_dashboard[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]:first-child{width:100%;min-height:100px;padding:25px;background-color:#eef5ef;border-radius:4px}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{min-width:126px!important}.is-invalid[_ngcontent-%COMP%]{border:1px solid red!important}"]})};var pe=[{path:"",component:_}],F=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=b({type:r});static \u0275inj=x({imports:[w.forChild(pe),w]})};var ie=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=b({type:r});static \u0275inj=x({imports:[P,F,Y]})};export{ie as ExchangesalariesModule};
